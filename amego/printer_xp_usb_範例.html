
<!DOCTYPE html>
<html>
<head>
<!--通用-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>
	<button onclick="requestDevice()">配對裝置</button>
	<button onclick="printInvoice()">列印發票</button>

	<script>
	var support = (typeof navigator.usb == 'object');
	var device;
	var endpointNumber = 1;

	// base64列印字串(發票)
	var invoice_base64 = 'G0AbQB1XowEdTAUAGyEAG2EBHSERGy0AHCa0+rjVtW+yvBwuGzM8Ch1MBQAbIQAbYQEdIREbLQAcJrVMqmunSbz6HC4bMzwKHUwAABshABthAR0hERstABwmuXGkbLVvsrzD0qn6wXAcLhszPAodTDIAGyEAG2EAHSERGy0AHCYxMTOmfjExLTEypOscLhszPAodTDwAGyEAG2EAHSERGy0AHCZBQy0zMDAwNTE4NBwuGzM8Ch1MFAAbIQAbYQAdIQAbLQAcJjIwMjQtMTItMjMgICAxNTo1Mzo1NRwuGzMeCh1MFAAbIQAbYQAdIQAbLQAcJsBIvve9WCA3MTU4ICAgICAgIMFgrXAgMTY4HC4bMx4KHUwUABshABthAB0hABstABwmveak6CAxMjM0NTY3OBwuGzMjChszDx1MFwAbIQAbYQAdSAAddwEdaDIda0UTMTEzMTJBQzMwMDA1MTg0NzE1OAobMzwdTBkAGyEAG2EAHXYwACoAlgD////+AAfAH////8APB4P////8AAAAD//////8AD8AD/8D/8D//////8D////+AAfAH////8APB4P////8AAAAD//////8AD8AD/8D/8D//////8D////+AAfAH////8APB4P////8AAAAD//////8AD8AD/8D/8D//////8D////+AAfAH////8APB4P////8AAAAD//////8AD8AD/8D/8D//////8DwAAAeAPgAAf//g8Hw+APAAAB8AAAAD//////8AD8AD/8D/8D//////8DwAAAeAPgAAf//g8Hw+APAAAB8AAAAD//////8AD8AD/8D/8D//////8DwAAAeAPgAAf//g8Hw+APAAAB8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8DwAAAeAPgAAf//g8Hw+APAAAB8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8DwAAAeAPgAAf//g8Hw+APAAAB8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8Dwf/weDwA8HgD//D4PB4PB//B8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8Dwf/weDwA8HgD//D4PB4PB//B8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8Dwf/weDwA8HgD//D4PB4PB//B8AAAAD8AAAAD8D8AD/8D8AAD8AAAAD8Dwf/weDwA8HgD//D4PB4PB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD//8AAAHw+APB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD//8AAAHw+APB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD//8AAAHw+APB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD//8AAAHw+APB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD//8AAAHw+APB//B8AAAAD8D//8D8D///////8AD8D//8D8Dwf/weAPgD4fAH/AAPB4PB//B8AAAAD8D//8D8AD//8AD//8D8D//8D8Dwf/weAPgD4fAH/AAPB4PB//B8AAAAD8D//8D8AD//8AD//8D8D//8D8Dwf/weAPgD4fAH/AAPB4PB//B8AAAAD8D//8D8AD//8AD//8D8D//8D8Dwf/weAPgD4fAH/AAPB4PB//B8AAAAD8D//8D8AD//8AD//8D8D//8D8DwAAAeAAf/4f8AAAHw+APAAAB8AAAAD8D//8D8AD//8AD//8D8D//8D8DwAAAeAAf/4f8AAAHw+APAAAB8AAAAD8D//8D8AD//8AD//8D8D//8D8DwAAAeAAf/4f8AAAHw+APAAAB8AAAAD8D//8D8D8AAAD8D8AD8D//8D8DwAAAeAAf/4f8AAAHw+APAAAB8AAAAD8D//8D8D8AAAD8D8AD8D//8D8DwAAAeAAf/4f8AAAHw+APAAAB8AAAAD8D//8D8D8AAAD8D8AD8D//8D8D////+DwfD4fD4fD4PB4P////8AAAAD8D//8D8D8AAAD8D8AD8D//8D8D////+DwfD4fD4fD4PB4P////8AAAAD8D//8D8D8AAAD8D8AD8D//8D8D////+DwfD4fD4fD4PB4P////8AAAAD8D//8D8D8AAAD8D8AD8D//8D8D////+DwfD4fD4fD4PB4P////8AAAAD8AAAAD8D/8D8AAD8AD8AAAAD8AAAAAADwA8AfAHgAHwAAAAAAAAAAAAD8AAAAD8D/8D8AAD8AD8AAAAD8AAAAAADwA8AfAHgAHwAAAAAAAAAAAAD8AAAAD8D/8D8AAD8AD8AAAAD8AAAAAADwA8AfAHgAHwAAAAAAAAAAAAD8AAAAD8D/8D8AAD8AD8AAAAD8AAAAAADwA8AfAHgAHwAAAAAAAAAAAAD8AAAAD8D/8D8AAD8AD8AAAAD8AAAAAADwA8AfAHgAHwAAAAAAAAAAAAD8AAAAD8D/8D8AAD8AD8AAAAD8D/+D///wAD4A8AA/4PAH/AAPAAAAAAD//////8D8D8D8D8D8D//////8D/+D///wAD4A8AA/4PAH/AAPAAAAAAD//////8D8D8D8D8D8D//////8D/+D///wAD4A8AA/4PAH/AAPAAAAAAD//////8D8D8D8D8D8D//////8D/+D///wAD4A8AA/4PAH/AAPAAAAAAD//////8D8D8D8D8D8D//////8APh8AB8Pg//gD//D4PB4AAHw+AAAAAD//////8D8D8D8D8D8D//////8APh8AB8Pg//gD//D4PB4AAHw+AAAAAD//////8D8D8D8D8D8D//////8APh8AB8Pg//gD//D4PB4AAHw+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAPh8AB8Pg//gD//D4PB4AAHw+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAPh8AB8Pg//gD//D4PB4AAHw+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAP///+AAf/4fD/g//wB4AB4P+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAP///+AAf/4fD/g//wB4AB4P+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAP///+AAf/4fD/g//wB4AB4P+AAAAAAAAAAAAAD/8AD////8AAAAAAAAAP///+AAf/4fD/g//wB4AB4P+AAAAAD/8D8AD/8AD8AD8AD8D//8D/8AAP///+AAf/4fD/g//wB4AB4P+AAAAAD/8D8AD/8AD8AD8AD8D//8D/8AD/+APgD//D4AAAA8AA//w+AP/8AAAAD/8D8AD/8AD8AD8AD8D//8D/8AD/+APgD//D4AAAA8AA//w+AP/8AAAAD/8D8AD/8AD8AD8AD8D//8D/8AD/+APgD//D4AAAA8AA//w+AP/8AAAAD/8D8AD/8AD8AD8AD8D//8D/8AD/+APgD//D4AAAA8AA//w+AP/8AAAAD/8D8AD/8AD8AD8AD8D//8D/8AAAAD/+Dwf///8HgAAAB//B4PB8AAAAAAD/8AAAD8D/8D8AAAAD/8AD/8AAAD/+Dwf///8HgAAAB//B4PB8AAAAAAD/8AAAD8D/8D8AAAAD/8AD/8AAAD/+Dwf///8HgAAAB//B4PB8AAAAAAD/8AAAD8D/8D8AAAAD/8AD/8AAAD/+Dwf///8HgAAAB//B4PB8AAAAAAD/8AAAD8D/8D8AAAAD/8AD/8AAAD/+Dwf///8HgAAAB//B4PB8AAAAAAD/8AAAD8D/8D8AAAAD/8AD/8APh/wADwf8AfD/gD4P+Hw+APAAAAAAAAD/8AAAD8D/8D8AAAAD/8AD/8APh/wADwf8AfD/gD4P+Hw+APAAAAAAAAAAAAD8AD/8AD8AD//8D8D/8AAPh/wADwf8AfD/gD4P+Hw+APAAAAAAAAAAAAD8AD/8AD8AD//8D8D/8AAPh/wADwf8AfD/gD4P+Hw+APAAAAAAAAAAAAD8AD/8AD8AD//8D8D/8ADwAAAeAAfD4fD4fD4AAH///w/8AAAAAAAAAAD8AD/8AD8AD//8D8D/8ADwAAAeAAfD4fD4fD4AAH///w/8AAAAAAAAAAD8AD/8AD8AD//8D8D/8ADwAAAeAAfD4fD4fD4AAH///w/8AAAAAAAAAAD8AD/8AD8AD//8D8D/8ADwAAAeAAfD4fD4fD4AAH///w/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8DwAAAeAAfD4fD4fD4AAH///w/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8DweAAAAAA8HgAAAAAA+Hw+AA/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8DweAAAAAA8HgAAAAAA+Hw+AA/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8DweAAAAAA8HgAAAAAA+Hw+AA/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8DweAAAAAA8HgAAAAAA+Hw+AA/8AAAAD8AD8D8D/8AAAAD/8D8AD//8D8AP//wf8Pg8AfD//8APAAPB4P/8AAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP//wf8Pg8AfD//8APAAPB4P/8AAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP//wf8Pg8AfD//8APAAPB4P/8AAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP//wf8Pg8AfD//8APAAPB4P/8AAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP//wf8Pg8AfD//8APAAPB4P/8AAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP///gAPg///8Hg8AA+Hw+H/+AAAAAAAAD8AD8AAAAD/8AAAAAAD8AAAAP///gAPg///8Hg8AA+Hw+H/+AAAAAAD8D//8D//////8AD/8D//8D/8AP///gAPg///8Hg8AA+Hw+H/+AAAAAAD8D//8D//////8AD/8D//8D/8AP///gAPg///8Hg8AA+Hw+H/+AAAAAAD8D//8D//////8AD/8D//8D/8AAB/wf8AAD/g/4f/4PB//B//B8AAAAAD8D//8D//////8AD/8D//8D/8AAB/wf8AAD/g/4f/4PB//B//B8AAAAAD8D//8D//////8AD/8D//8D/8AAB/wf8AAD/g/4f/4PB//B//B8AAAAAD8D//8D//////8AD/8D//8D/8AAB/wf8AAD/g/4f/4PB//B//B8AAAAD8D/8D/8D//8D8D8AAD8D8D//8AAB/wf8AAD/g/4f/4PB//B//B8AAAAD8D/8D/8D//8D8D8AAD8D8D//8AAf/wB///8H/AAA/4PB4P+HwAAAAAAD8D/8D/8D//8D8D8AAD8D8D//8AAf/wB///8H/AAA/4PB4P+HwAAAAAAD8D/8D/8D//8D8D8AAD8D8D//8AAf/wB///8H/AAA/4PB4P+HwAAAAAAD8D/8D/8D//8D8D8AAD8D8D//8AAf/wB///8H/AAA/4PB4P+HwAAAAAAD8D/8D/8D//8D8D8AAD8D8D//8Dwf8P+APgD4fD4A/4AAAPB4AB8AAAAAD//8D8AD/8AD/8D8D/8AD///8Dwf8P+APgD4fD4A/4AAAPB4AB8AAAAAD//8D8AD/8AD/8D8D/8AD///8Dwf8P+APgD4fD4A/4AAAPB4AB8AAAAAD//8D8AD/8AD/8D8D/8AD///8Dwf8P+APgD4fD4A/4AAAPB4AB8AAAAAD//8D8AD/8AD/8D8D/8AD///8Dwf8P+APgD4fD4A/4AAAPB4AB8AAAAAD//8D8AD/8AD/8D8D/8AD///8AAf8Ph8PgD/g/4AD4A+Hw+Hw/8AAAAAD//8D8AD/8AD/8D8D/8AD///8AAf8Ph8PgD/g/4AD4A+Hw+Hw/8AAAAD//8D8D8AD8D8D/8D////8D8AAAAf8Ph8PgD/g/4AD4A+Hw+Hw/8AAAAD//8D8D8AD8D8D/8D////8D8AAAAf8Ph8PgD/g/4AD4A+Hw+Hw/8AAAAD//8D8D8AD8D8D/8D////8D8AAAAf8Ph8PgD/g/4AD4A+Hw+Hw/8AAAAD//8D8D8AD8D8D/8D////8D8AADwAAAeDwAD///4A/4PB4PB4P+AAAAAD//8D8D8AD8D8D/8D////8D8AADwAAAeDwAD///4A/4PB4PB4P+AAAAAD//8D8D8AD8D8D/8D////8D8AADwAAAeDwAD///4A/4PB4PB4P+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8DwAAAeDwAD///4A/4PB4PB4P+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8AP///h8AA8AAD/g//w+Hw+AP+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8AP///h8AA8AAD/g//w+Hw+AP+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8AP///h8AA8AAD/g//w+Hw+AP+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8AP///h8AA8AAD/g//w+Hw+AP+AAAAAAAAAAAAAD/8AAAD//8AAD8D8D8AP///h8AA8AAD/g//w+Hw+AP+AAAAAD//////8D8D8AD8AD8D8D8D8D8DweDwf//g//g8Hg///B///4P+AAAAAD//////8D8D8AD8AD8D8D8D8D8DweDwf//g//g8Hg///B///4P+AAAAAD//////8D8D8AD8AD8D8D8D8D8DweDwf//g//g8Hg///B///4P+AAAAAD//////8D8D8AD8AD8D8D8D8D8DweDwf//g//g8Hg///B///4P+AAAAAD//////8D8D8AD8AD8D8D8D8D8AAAAAADwf8Hg///AH//4AB4PAAAAAAD//////8D8D8AD8AD8D8D8D8D8AAAAAADwf8Hg///AH//4AB4PAAAAAAD8AAAAD8AAD/8D8D/8AAD8AAD8AAAAAADwf8Hg///AH//4AB4PAAAAAAD8AAAAD8AAD/8D8D/8AAD8AAD8AAAAAADwf8Hg///AH//4AB4PAAAAAAD8AAAAD8AAD/8D8D/8AAD8AAD8AAAAAADwf8Hg///AH//4AB4PAAAAAAD8AAAAD8AAD/8D8D/8AAD8AAD8D////+D/g/4fD///4PB4PB//B8AAAAD8AAAAD8AAD/8D8D/8AAD8AAD8D////+D/g/4fD///4PB4PB//B8AAAAD8AAAAD8AAD/8D8D/8AAD8AAD8D////+D/g/4fD///4PB4PB//B8AAAAD8D//8D8AAD//8D//////8AAAAD////+D/g/4fD///4PB4PB//B8AAAAD8D//8D8AAD//8D//////8AAAADwAAAeDwA//g//g8AAB4AB4PAAAAAAD8D//8D8AAD//8D//////8AAAADwAAAeDwA//g//g8AAB4AB4PAAAAAAD8D//8D8AAD//8D//////8AAAADwAAAeDwA//g//g8AAB4AB4PAAAAAAD8D//8D8AAD//8D//////8AAAADwAAAeDwA//g//g8AAB4AB4PAAAAAAD8D//8D8AAD//8D//////8AAAADwAAAeDwA//g//g8AAB4AB4PAAAAAAD8D//8D8D8AD//8AD8D/////8ADwf/weDwf/4AAHgAAPB////wB8AAAAD8D//8D8D8AD//8AD8D/////8ADwf/weDwf/4AAHgAAPB////wB8AAAAD8D//8D8D8AD//8AD8D/////8ADwf/weDwf/4AAHgAAPB////wB8AAAAD8D//8D8D8AD//8AD8D/////8ADwf/weDwf/4AAHgAAPB////wB8AAAAD8D//8D8D8AD//8AD8D/////8ADwf/weAAfAAfAHg///+Hw///+AAAAAD8D//8D8D8AD//8AD8D/////8ADwf/weAAfAAfAHg///+Hw///+AAAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weAAfAAfAHg///+Hw///+AAAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weAAfAAfAHg///+Hw///+AAAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weAAfAAfAHg///+Hw///+AAAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weDwAD4A/4f//wB4PB/wB8AAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weDwAD4A/4f//wB4PB/wB8AAAAD8D//8D8AD8D///8AAAD8AAAD8Dwf/weDwAD4A/4f//wB4PB/wB8AAAAD8AAAAD8D8D///8AAD8AD//8AADwf/weDwAD4A/4f//wB4PB/wB8AAAAD8AAAAD8D8D///8AAD8AD//8AADwAAAeDwA//g8AAD4A+HwB/w/8AAAAD8AAAAD8D8D///8AAD8AD//8AADwAAAeDwA//g8AAD4A+HwB/w/8AAAAD8AAAAD8D8D///8AAD8AD//8AADwAAAeDwA//g8AAD4A+HwB/w/8AAAAD8AAAAD8D8D///8AAD8AD//8AADwAAAeDwA//g8AAD4A+HwB/w/8AAAAD8AAAAD8D8D///8AAD8AD//8AADwAAAeDwA//g8AAD4A+HwB/w/8AAAAD//////8D8D/8AD8AD/8AAAD/8D////+DwA8Af8AA//wB4P+AAB8AAAAD//////8D8D/8AD8AD/8AAAD/8D////+DwA8Af8AA//wB4P+AAB8AAAAD//////8D8D/8AD8AD/8AAAD/8D////+DwA8Af8AA//wB4P+AAB8AAAAD//////8D8D/8AD8AD/8AAAD/8D////+DwA8Af8AA//wB4P+AAB8AAAAD//////8D8D/8AD8AD/8AAAD/8D////+DwA8Af8AA//wB4P+AAB8AAAAD//////8D8D/8AD8AD/8AAAD/8AKHUwAABshABthAB0hABstABwmIBwuGzMBCh1MAAAbIQAbYQAdIQAbLQAcJiAcLhszFAodVgEAHUyAABshABthAB0hABstABwmvlCzZqn6stOz5hwuGzMeCh1MBQAbIQAbYQAdIQAbLQAcJsDnt36kSLLOvXOhRzEyMzQ1Njc4HC4bMx4KHUwFABshABthAB0hABstABwmtPq41cD0udKms62tpL2lcRwuGzMeCh1MBQAbIQAbYQAdIQAbLQAcJsDnt36kSKZhp32hR7tPpKSlq6bosM+2aaTGpV+49DIzOLi5MTS806SnNRwuGzMeCh1MBQAbIQAbYQAdIQAbLQAcJqXmqfauybahoUcyMDI0LTEyLTIzIDE1OjUzOjU1HC4bMx4KHUwFABshABthAB0hABstABwmq36mVy+8xrZxoUChQKFAs+a7+aFAoUChQKr3w0IcLhszHgodTAUAGyEAG2EAHSEAGy0AHCa0+rjVsNOrfjEcLhszHgodTAUAGyEAG2EAHSEAGy0AHCYgICAgICAgMSAgICAgIDE3MCAgICAgICAgIDE3MFRYHC4bMx4KHUwFABshABthAB0hABstABwmt3yt+6fpqegcLhszHgodTAUAGyEAG2EAHSEAGy0AHCYgICAgICAgMSAgICAgICAtMiAgICAgICAgICAtMlRYHC4bMx4KHUwFABshABthAB0hABstABwmwWChQK1woUcxNjgcLhszHgodTAAAGyEAG2EAHSEAGy0AHCYgHC4bM2QKHVYAAA==';

	if ( !support ) {
		alert('此瀏覽器不支援USB列印，請更換瀏覽器進行列印！');
	}
	else {
		// 進此網頁時，自動查詢上次配對裝置
		navigator.usb.getDevices().then((devices) => {
			if ( devices.length > 0 ) {
				// 配對過的第一個裝置
				device = devices[0];

				// 與裝置建立連線
				printerOpen();
			}
			else {
				console.log('無上次配對裝置');
			}
		});
	}

	// base64 轉 js 陣列
	function base64ToArray(base64){
		var binary_string = window.atob(base64);
		var len = binary_string.length;
		var bytes = new Uint8Array(len);
		for (var i = 0; i < len; i++) {
			var v = binary_string.charCodeAt(i);
			v = v < 0 ? (v + 256) : v;
			bytes[i] = v;
		}
		return bytes;
	}

	// 要求配對裝置
	function requestDevice(){
		// navigator.usb.requestDevice 需要透過 UI 觸發
		navigator.usb.requestDevice({
			filters: [
				// 設定只顯示此廠牌的裝置，以免鍵盤、滑鼠等裝置出現在列表
				{ vendorId: 0x0483 }, // 芯燁
				{ vendorId: 0x04D8, productId: 0x000A }, // WP-T810
			]
		})
		.then(usbDevice => {
			console.log("Product name: " + usbDevice.productName);

			// 使用者從列表選取的裝置
			device = usbDevice;

			// 與裝置建立連線
			printerOpen();
		})
		.catch(e => {
			var msg = '';
			msg += '列印失敗\n';
			msg += '無配對 USB 印表機\n';
			msg += '檢查印表機是否有選擇配對\n';
			msg += '檢查印表機是否有啟動';
			alert(msg);

			console.error(e);
		});
	}

	// 建立連線
	function printerOpen() {
		if ( device ) {
			// console.log(device.opened)

			// 未連線
			if ( !device.opened ) {
				device.open()
				.then(() => device.selectConfiguration(1))
				.then(function() {
					device.configuration.interfaces.forEach((interface) => {
						interface.alternate.endpoints.forEach((endpoint) => {
							// in:讀取 2:寫入
							if ( endpoint.direction == 'out' ) {
								// 選有寫入的 interface
								return device.claimInterface(interface.interfaceNumber);
							}
						});
					});
				})
				.catch(function(e) {
					// 建立連線失敗
					device = null;

					var msg = '';
					msg += '列印失敗\n';
					msg += '與 USB 印表機連線失敗\n';
					msg += '檢查印表機驅動是否有安裝正確\n';
					msg += '是否有其他網頁同時連線到印表機';
					alert(msg);

					console.log(e)
				})
				.then(() => {
					if ( device ) {
						alert('與裝置配對連線成功');
					}
				});
			}
			// 已連線
			else {
				alert('與裝置配對連線成功');
			}
		}
		else {
			alert('連線錯誤，尚未配對');
		}
	}

	function onSendMessage(print_data){
		if ( device ) {
			// 傳輸資料
			device.transferOut(endpointNumber, print_data)
			.then(() => {
				alert('列印成功');
			})
			.catch(e => {
				if (e.message.includes('The specified endpoint is not part of a claimed and selected alternate interface')) {
					if (endpointNumber < 15) {
						// 更換 endpoint
						endpointNumber = endpointNumber + 1;
						console.log(endpointNumber)

						// 嘗試重送資料
						onSendMessage(print_data);

						return;
					}

					var msg = '';
					msg += '列印失敗\n';
					msg += '無法傳輸資料至 USB 印表機\n';
					msg += '檢查印表機是否有啟動';
					alert(msg);

					return;
				}

				console.error('Send Error:', e);

				var msg = '';
				msg += '列印失敗\n';
				msg += '無法傳輸資料至 USB 印表機\n';
				msg += '檢查印表機是否有啟動';
				alert(msg);
			});
		}
		else {
			alert('列印錯誤，尚未配對與連線');
		}
	}

	function printInvoice() {
		// 資料轉換
		var print_data = base64ToArray(invoice_base64);

		onSendMessage(print_data);
	}
	</script>
</body>
</html>
